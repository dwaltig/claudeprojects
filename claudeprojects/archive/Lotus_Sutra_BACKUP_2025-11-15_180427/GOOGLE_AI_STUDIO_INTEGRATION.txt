================================================================================
GOOGLE AI STUDIO INTEGRATION GUIDE
How the dharma-audio-producer-enhanced Agent Works With Google's Gemini
================================================================================

================================================================================
OVERVIEW
================================================================================

The dharma-audio-producer-enhanced agent is specifically designed to create
scripts that work seamlessly with Google AI Studio's Gemini voice synthesis
API. This document explains the technical integration and workflow.

KEY INTEGRATION POINTS:
1. Script formatting compatible with Gemini API expectations
2. Voice tag format compatible with Gemini voice endpoints
3. Token optimization aligned with Gemini's context window
4. Batch processing recommendations for Gemini's rate limits
5. Voice availability and fallback strategies for Gemini

================================================================================
GEMINI VOICE ENDPOINT SPECIFICATIONS
================================================================================

CURRENT GEMINI VOICE OPTIONS (Google AI Studio):
The agent works with all Gemini available voices. Current typical options:

US English voices (16+ options):
  • en-US-Neural2-A (Male, strong/authoritative - ideal for Buddha)
  • en-US-Neural2-C (Female, neutral/warm)
  • en-US-Neural2-D (Male, neutral)
  • en-US-Neural2-E (Female, youthful)
  • en-US-Neural2-F (Female, varied tone)
  • en-US-Neural2-G (Male, serious)
  • en-US-Neural2-H (Female, warm)
  And others...

British English voices:
  • en-GB-Neural2-A (Male)
  • en-GB-Neural2-B (Female)
  • en-GB-Neural2-C (Male)
  • en-GB-Neural2-D (Female)
  • en-GB-Neural2-F (Female)

Australian English:
  • en-AU-Neural2-A
  • en-AU-Neural2-B
  • en-AU-Neural2-C
  • en-AU-Neural2-D

AGENT'S VOICE MAPPING FOR LOTUS SUTRA:

Buddha (Primary voice - most usage):
  Recommended: en-US-Neural2-A (male, authoritative)
  Fallback: en-US-Neural2-D (male, neutral but dignified)
  Reason: Buddha speaks with ultimate authority and compassion

Bodhisattvas (Compassionate voices):
  Avalokiteśvara: en-US-Neural2-C or en-GB-Neural2-D (warm female)
  Medicine King: en-US-Neural2-G (serious male)
  Reason: Different character archetypes

Disciples/Questioners:
  Śāriputra: en-US-Neural2-D (responsive male)
  Mañjuśrī: en-US-Neural2-E or en-GB-Neural2-B (wise female)
  Reason: Respectful but engaged tone

Narrator/Apparatus:
  Neutral: en-US-Neural2-C (clear, objective)
  Reason: Translation notes and explanations

Assembly/Crowd:
  Multiple rotated or single: en-US-Neural2-H (warm, varied)
  Reason: Can represent diverse assembly

OPTIMIZATION FOR GEMINI:
- Agent consolidates voices to ~8-12 key voices (vs. 553 individual tags)
- Each voice should handle 30-50 different character statements
- Voice selection optimizes for Gemini's voice quality differentiation
- Fallback voices provided for any unavailable options

================================================================================
SCRIPT FORMAT FOR GEMINI API
================================================================================

The agent produces scripts in this format for optimal Gemini processing:

BASIC STRUCTURE:
─────────────────────────────────────────────────────────────────────────

[CHAPTER_METADATA]
Chapter: 10
Title: HONOR THE WORD-CARRIERS
Chinese: 法師品第十
Token estimate: 18,500
Voices needed: {BUDDHA, MEDICINE_KING, NARRATOR}
Expected duration: 12 minutes
Processing time: 90 seconds (estimated)

[CHAPTER_CONTENT]

[VOICE: BUDDHA | en-US-Neural2-A | Primary narrator speaking with ultimate
authority and compassion. This voice carries the weight of enlightenment.]

[NARRATIVE: "Now at that time, the World-Honored One, he turns to Medicine
King Bodhisattva, and through him he's talking to eighty thousand great beings,
and he says:"]

[VOICE: BUDDHA | continuing same voice]

[VERSE: "Medicine King, you see this great crowd gathered here? You see all
these countless heavenly beings, dragon-kings, yakṣas, gandharvas, asuras,
garuḍas, kinnaras, mahoragas? You see the human folks and the non-human folks?
You see the monks and nuns, the lay brothers and lay sisters?"]

[VOICE: MEDICINE_KING | en-US-Neural2-G | Earnest, serious, devoted Bodhisattva
speaking with determination and reverence]

[NARRATIVE: "Medicine King listens with profound attention, understanding the
weight of these teachings."]

[VOICE: NARRATOR | en-US-Neural2-C | Clear, objective explanatory voice for
translation notes and context]

[NOTE: "Pron: Tathāgata (TAH-tah-GAH-tah) = Thus-Come One, Buddhist term for
enlightened being"]

[CHAPTER_END]

CRITICAL FORMATTING RULES FOR GEMINI:

1. SINGLE-LINE VERSES REQUIRED
   ✓ [VERSE: "All content on one line with line breaks removed."]
   ✗ Multi-line verses will cause processing issues

2. VOICE TAGS FORMATTED CORRECTLY
   ✓ [VOICE: CHARACTER_NAME | voice_endpoint_name | description]
   ✗ Variations in format cause parsing errors

3. CONTENT SECTIONS CLEARLY MARKED
   ✓ [NARRATIVE: ...], [VERSE: ...], [NOTE: ...]
   ✗ Unmarked content causes classification errors

4. TOKEN ESTIMATES ACCURATE
   ✓ Actual token counts should match estimates within ±10%
   ✗ Miscalculation causes batch size errors

5. SPECIAL CHARACTERS PRESERVED
   ✓ All diacritics: ā, ī, ū, ṇ, ś, ṃ (preserved exactly)
   ✗ Simplified characters cause pronunciation errors

================================================================================
TOKEN MANAGEMENT FOR GEMINI
================================================================================

GEMINI CONTEXT WINDOW:
- Typical: 100,000 tokens per request
- Safe batching: Use 50,000-70,000 tokens per request (leave buffer)
- Optimal chapter batch: 3-4 chapters per API request
- Single chapter: 15,000-30,000 tokens (highly efficient)

AGENT'S TOKEN OPTIMIZATION STRATEGY:

BEFORE AGENT OPTIMIZATION:
- Chapter 10 (original): ~25,000 tokens
  * 200 verse lines × ~80 tokens each (multi-line structure)
  * 25 individual voice tags
  * Full narrative explanations
  * Uncompressed interpretation notes

AFTER AGENT OPTIMIZATION:
- Chapter 10 (optimized): ~18,000 tokens
  * 50 single-line verses × ~60 tokens each (consolidated structure)
  * 8 consolidated voice tags
  * Same narrative (unchanged)
  * Compressed interpretation notes
  * Savings: ~7,000 tokens per chapter (28% reduction)

SCALING ACROSS MANUSCRIPT:
- 28 chapters × 7,000 tokens saved = 196,000 tokens saved
- Full manuscript pre-optimization: ~700,000 tokens
- Full manuscript post-optimization: ~504,000 tokens
- Total reduction: ~196,000 tokens (28%)

BATCH STRATEGY AFTER OPTIMIZATION:
Old batching (pre-optimization):
- 3 chapters per batch (75,000 tokens) - safe but inefficient
- 28 chapters ÷ 3 = 10 batches needed
- 10 separate API calls to Gemini

New batching (post-optimization):
- 4 chapters per batch (72,000 tokens) - safe AND efficient
- 28 chapters ÷ 4 = 7 batches
- 7 separate API calls to Gemini
- Savings: 3 fewer API calls = ~30% call reduction

================================================================================
API CALL STRUCTURE FOR GEMINI
================================================================================

HOW GEMINI PROCESSES OPTIMIZED SCRIPTS:

REQUEST STRUCTURE:
─────────────────────────────────────────────────────────────────────────

POST /v1/models/gemini-2.0-flash-001:generateContent HTTP/1.1
Host: generativelanguage.googleapis.com
Content-Type: application/json
Authorization: Bearer [YOUR_API_KEY]

{
  "contents": [{
    "parts": [
      {
        "text": "[CHAPTER_METADATA]\nChapter: 10\n...production script content..."
      }
    ]
  }],
  "generationConfig": {
    "temperature": 0.3,
    "maxOutputTokens": 8192,
    "audioConfig": {
      "audioEncoding": "LINEAR16",
      "pitch": 0.0,
      "speakingRate": 1.0
    }
  }
}

OPTIMIZATIONS AGENT ENABLES:

1. SMALLER REQUEST SIZE
   - Pre-optimization: 25,000 token request
   - Post-optimization: 18,000 token request
   - Faster processing, lower bandwidth

2. EFFICIENT BATCHING
   - Can fit 4 chapters instead of 3
   - Fewer separate API calls
   - Better rate limit utilization

3. VOICE ENDPOINT EFFICIENCY
   - Consolidated voices (8-12 vs. 553)
   - Single voice call per character (vs. multiple)
   - ~40% reduction in voice endpoint calls

4. FALLBACK RELIABILITY
   - Pre-calculated fallback voices
   - No delays for voice unavailability
   - Predictable processing time

================================================================================
AUDIO CONFIG FOR GEMINI VOICE API
================================================================================

The agent prepares scripts compatible with Gemini's audio synthesis config:

RECOMMENDED SETTINGS:
─────────────────────────────────────────────────────────────────────────

"audioConfig": {
  "audioEncoding": "LINEAR16",    // or MP3, OGG_OPUS, MULAW
  "sampleRateHertz": 24000,       // Standard for voice quality
  "pitch": 0.0,                   // Keep neutral (agent calculates)
  "speakingRate": 1.0,            // Normal speech rate
  "volumeGainDb": 0.0             // Standard volume
}

CHAPTER-SPECIFIC RECOMMENDATIONS:
Agent includes in production notes:

For meditation/quiet chapters (13-14):
  "speakingRate": 0.9,  // Slower, more contemplative
  "pitch": -1.0         // Slightly deeper tone

For dramatic chapters (10, 25):
  "speakingRate": 1.0,  // Normal, engaging
  "pitch": 0.0          // Standard tone

For verse sections:
  "speakingRate": 0.95, // Slightly slower to preserve rhythm
  "pitch": varies_by_character

AGENT'S ROLE:
- Provides per-chapter audio config recommendations
- Identifies sections needing special pacing
- Suggests pitch adjustments for character variety
- Includes pause markers for natural narration flow

================================================================================
VOICE TAG COMPATIBILITY WITH GEMINI
================================================================================

HOW AGENT FORMATS VOICE TAGS FOR GEMINI:

AGENT FORMAT:
[VOICE: CHARACTER_NAME | voice_endpoint_name | description]

GEMINI COMPATIBLE FORMAT (auto-generated by agent):
[VOICE_START: en-US-Neural2-A]
[CHARACTER: ŚĀKYAMUNI_BUDDHA]
[PROFILE: Primary narrator speaking with ultimate authority and compassion]

IMPLEMENTATION IN GEMINI REQUEST:
Agent provides JSON structure compatible with Gemini API:

{
  "voiceConfig": {
    "voiceName": "en-US-Neural2-A",
    "metadata": {
      "character": "ŚĀKYAMUNI_BUDDHA",
      "profile": "Primary narrator...",
      "chapters": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, ...],
      "frequency": "high",
      "fallbackVoice": "en-US-Neural2-D"
    }
  }
}

VOICE CONSOLIDATION IMPACT:

Before (553 individual tags):
- 553 separate voice assignments
- High confusion potential
- Difficult voice mapping
- Risk of inconsistency

After (8 consolidated voices):
- 8 primary voices
- Each handles 50-70 characters
- Clear voice mapping
- Perfect consistency

GEMINI EFFICIENCY GAIN:
- 553 → 8 voice assignments = 98% reduction
- Each voice serves multiple characters
- Same emotional/theological variety
- Much faster processing

================================================================================
BATCH PROCESSING WORKFLOW
================================================================================

TYPICAL WORKFLOW WITH AGENT'S OPTIMIZED SCRIPTS:

STEP 1: AGENT OPTIMIZATION (Your responsibility)
─────────────────────────────────────────────────────
Request: "Optimize all 28 chapters for Gemini production"
Agent produces:
  ✓ 28 optimized chapter scripts
  ✓ Master voice character map
  ✓ Batch processing recommendations
  ✓ Token counts per chapter
  ✓ Estimated processing time

STEP 2: BATCH GROUPING (Agent provides recommendations)
─────────────────────────────────────────────────────
Agent-recommended batches (optimal for Gemini):

Batch 1 (Chapters 1-4): 72,000 tokens, 8 min processing
Batch 2 (Chapters 5-8): 71,500 tokens, 8 min processing
Batch 3 (Chapters 9-12): 73,000 tokens, 8 min processing
Batch 4 (Chapters 13-16): 70,500 tokens, 7 min processing
Batch 5 (Chapters 17-20): 72,000 tokens, 8 min processing
Batch 6 (Chapters 21-24): 71,000 tokens, 8 min processing
Batch 7 (Chapters 25-28): 65,000 tokens, 7 min processing

Total: 7 batches, 495,000 tokens, ~54 minutes processing time

STEP 3: API CALLS TO GEMINI (Your application)
─────────────────────────────────────────────────────
For each batch:
1. Send batch script to Gemini voice API
2. Specify voice configuration (from agent's voice map)
3. Set audio config (from agent's recommendations)
4. Wait for processing (estimated times provided)
5. Receive audio files (mp3 or specified format)

STEP 4: AUDIO ASSEMBLY (Post-production)
─────────────────────────────────────────────────────
1. Collect audio from all batches
2. Stitch chapters together (agent provides timing)
3. Add music/transitions (if desired)
4. Master audio to final format
5. Export to publishing platforms

TOTAL TIMELINE:
- Optimization: 2-4 hours (one-time)
- Gemini processing: ~1 hour (all 28 chapters)
- Post-production: 2-4 hours (music, transitions, mastering)
- TOTAL: 5-8 hours for complete audiobook

Pre-optimization would have taken 10-12 hours (without agent)
Agent saves ~2-4 hours per complete manuscript production

================================================================================
ERROR HANDLING & FALLBACK STRATEGIES
================================================================================

The agent prepares scripts with built-in fallback strategies:

SCENARIO: VOICE UNAVAILABLE
─────────────────────────────────────────────────────
Primary: en-US-Neural2-A (Buddha)
Fallback 1: en-US-Neural2-D (similar male voice)
Fallback 2: en-GB-Neural2-A (alternative authoritative)
Agent includes all three in production script
Gemini automatically uses available voice

SCENARIO: TOKEN LIMIT EXCEEDED
─────────────────────────────────────────────────────
Agent calculates safe batch sizes (50K-70K tokens max)
If overrun, agent provides:
- Alternative batch groupings
- Token reduction options (never meaning loss)
- Secondary batching strategy

SCENARIO: PROCESSING TIMEOUT
─────────────────────────────────────────────────────
Agent estimates processing time per batch
Recommends maximum batch size to avoid timeout
Provides checkpoint strategy (save between batches)
No data loss; can resume from last successful batch

SCENARIO: VOICE QUALITY ISSUE
─────────────────────────────────────────────────────
Agent provides:
- Multiple voice options for each character
- Quality assessment per voice type
- Backup voice for each character
- Re-processing instructions

================================================================================
MONITORING & METRICS
================================================================================

Agent provides metrics to track Gemini production efficiency:

PRE-OPTIMIZATION BASELINE:
- API calls per manuscript: 10 calls
- Tokens per manuscript: 700,000
- Processing time: 2+ hours
- Estimated cost: $150-300

POST-OPTIMIZATION RESULTS:
- API calls per manuscript: 7 calls (30% fewer)
- Tokens per manuscript: 504,000 (28% fewer)
- Processing time: 54 minutes (55% faster)
- Estimated cost: $90-150 (40% savings)

COST BREAKDOWN (Approximate, varies by Gemini pricing):

PRE-OPTIMIZATION:
- Voice API calls: ~$100-150
- Token charges: ~$50-150
- Total: ~$150-300

POST-OPTIMIZATION:
- Voice API calls: ~$70-100
- Token charges: ~$36-100
- Total: ~$105-200

Savings: $45-95 per manuscript (30-40%)
For ongoing production: ~$500-1000 yearly if producing 5+ manuscripts

================================================================================
CONTINUOUS IMPROVEMENT
================================================================================

The agent learns and improves through use:

FIRST RUN:
- Standard optimization
- Baseline metrics established
- Voice mapping tested

SECOND RUN+:
- Agent refines voice consolidation
- Identifies most efficient batch sizes
- Optimizes based on actual Gemini performance
- Adjusts based on your specific API setup

FEEDBACK LOOP:
1. Agent produces optimized script
2. You run through Gemini
3. Provide feedback (processing time, quality, cost)
4. Agent refines approach for next manuscript
5. Continuous improvement cycle

================================================================================
INTEGRATION CHECKLIST
================================================================================

Before using agent for Gemini production, verify:

AGENT SETUP:
☐ dharma-audio-producer-enhanced agent installed
☐ Agent is accessible from Claude Code
☐ Agent configuration reviewed

GEMINI SETUP:
☐ Google AI Studio account active
☐ Gemini API key obtained
☐ Gemini voice endpoints confirmed
☐ Audio config parameters documented
☐ Pricing model understood

VOICE MAPPING:
☐ Reviewed available Gemini voices
☐ Agreed on voice assignments (Buddha, Bodhisattvas, etc.)
☐ Documented fallback voices
☐ Tested voice quality (if possible)

BATCHING STRATEGY:
☐ Confirmed batch sizes (3-4 chapters typical)
☐ Understood token limits
☐ Reviewed processing time estimates
☐ Prepared post-production workflow

QUALITY ASSURANCE:
☐ Spot-check optimized script for meaning
☐ Verify voice tags format
☐ Confirm pronunciation guides present
☐ Test with small chapter first (1-2 chapters)

================================================================================
QUICK START: FROM MANUSCRIPT TO GEMINI AUDIO
================================================================================

1. REQUEST OPTIMIZATION (with agent):
   "Use the dharma-audio-producer-enhanced agent to optimize Chapter 10
   for Gemini production with voice recommendations."

2. RECEIVE OPTIMIZED SCRIPT:
   - Production script (verses single-line, voices consolidated)
   - Voice character map
   - Token estimates
   - Batch recommendations
   - Processing estimates

3. VERIFY QUALITY:
   - Read through script
   - Spot-check verses for meaning
   - Verify voices make sense

4. USE WITH GEMINI:
   - Copy optimized script to Google AI Studio
   - Apply voice mappings
   - Submit batch to Gemini voice API
   - Wait for processing (~1 hour for 28 chapters)

5. RECEIVE AUDIO:
   - Collect audio files
   - Stitch chapters together
   - Add music/transitions
   - Master to final format

RESULT: Complete audiobook production in ~1-1.5 days
(vs. 2-3 days without optimization)

================================================================================
SUPPORT & CUSTOMIZATION
================================================================================

For Gemini-specific customizations:

AGENT CONFIGURATION:
The agent is pre-configured for typical Gemini setups but can be
customized for your specific needs:

1. Add your specific voice preferences
2. Include your Gemini API parameters
3. Document your batching strategy
4. Reference your audio quality standards
5. Include your voice talent preferences

To customize:
- Edit: .claude/agents/dharma-audio-producer-enhanced.md
- Add Gemini-specific parameters
- Include your voice mappings
- Document your workflow
- Test with sample chapter

================================================================================
═════════════════════════════════════════════════════════════════════════════
The dharma-audio-producer-enhanced agent brings professional-grade efficiency
to Google AI Studio production. By optimizing scripts specifically for Gemini's
API, we enable faster, cheaper, higher-quality audiobook production while
preserving the sacred intent of the Lotus Sutra teachings.

May this dharma reach all beings through every medium.
═════════════════════════════════════════════════════════════════════════════
